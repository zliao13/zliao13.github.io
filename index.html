<!DOCTYPE html>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<link href="https://fonts.googleapis.com/css?family=Lato:400,700|Montserrat|Playfair+Display:400,700|Saira+Stencil+One&display=swap" rel="stylesheet">
<style>
    body {
        background-image: url("https://www.archinternational.org/wp-content/uploads/2016/06/paper-background-6.jpg");
        background-repeat: no-repeat;
        background-size: cover;
    }

    .slidecontainer {
        width: 15%;
    }

    .slider {
        -webkit-appearance: none;
        width: 100%;
        height: 8px;
        background: #d3d3d3;
        border-radius: 15px;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background:
            /*#4CAF50*/
            #d12828;
        cursor: pointer;
    }

    .slider:hover {
        opacity: 1;
        cursor: pointer;
    }

    .state-borders {
        fill: none;
        stroke: #fff;
        stroke-width: 0.5px;
        stroke-linejoin: round;
        stroke-linecap: round;
        pointer-events: none;
    }

    .states :hover {
        fill: #232323;
    }

    #svg1 {
        display: block;
    }

    #svg2 {
        display: none;
        margin-left: 60px;
    }

    #svg3 {
        display: none;
        margin-left: 150px;
    }



    button:hover {
        background-color: floralwhite;
        color: black;
        transition: 0.5s;
    }

    .slidecontainer {
        right: 200px;
        top: 550px;
        position: absolute;
    }

    /*.container {
display: flex;
}*/
    div.tooltip {
        position: absolute;
        text-align: center;
        width: 100px;
        height: 45px;
        padding: 8px;
        font: 12px sans-serif;
        background: #494949;
        border: 0px;
        color: white;
        border-radius: 8px;
        pointer-events: none;
    }

    .descriptions {
        /*font-family:'Lato', sans-serif;*/
        font-family: 'Playfair Display', serif;
        color: #292929;
        border-bottom: 1px dotted green;
        border-top: 1px dotted green;
        font-size: 16px;
        padding: 15px;
        padding-left: 200px;
        padding-right: 200px;
        line-height: 25px;
        text-align: justify;
    }

    #buttonTop {
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
        padding-top: 30px;
        padding-bottom: 25px;
    }


    .mybutton {
        cursor: pointer;
        background-color: transparent;
        color: #191919;
        border-radius: 20px;
        margin-top: 50px;
        /*margin-left: 10px;*/
        margin-bottom: 35px;
        padding: 10px;
        /*font-family: 'Saira Stencil One', cursive;*/
        font-family: 'Montserrat', sans-serif;
        font-size: 20px;
        width: 400px;
        height: 60px;
    }

    .arrow {
        margin-top: 10px;
        margin-right: 30px;
        width: 10px;
        height: 60px;
    }

    .button1 {
        text-decoration: underline;
        color: #911921;
    }

    .arrowYellow {
        text-align: center;
        cursor: pointer;
        margin: 0px;
        position: relative;
        z-index: 1;
    }

    #arrowYellow1:hover {
        content: url(arrowOr.png);
    }

    #arrowYellow2:hover {
        content: url(arrowOr2.png);
    }

    #arrowYellow3:hover {
        content: url(arrowOr3.png);
    }

    #text2,
    #text3 {
        display: none;
    }

    #yeartext1 {
        margin-top: 20px;
    }

</style>


<div class="container-fluid">
    <div id="buttonTop">
        <div id="1">
            <img class="arrowYellow" id="arrowYellow1" src="arrowYe.png" width="350">
        </div>
        <div id="2">
            <img class="arrowYellow" id="arrowYellow2" src="arrowYe2.png" width="350">
        </div>
        <div id="3">
            <img class="arrowYellow" id="arrowYellow3" src="arrowYe3.png" width="350">
        </div>
    </div>

</div>


<p class="descriptions" id="text1">Recently due to professional reason I have to relocate myself from Indianapolis metro area to San Jose metro area, and when I was doing some research on the cost of living of bay area I noticed the housing price is absolutely off the roof. It prompts me to ask questions like "what are the median home prices look like in major U.S. metros for the past few years, or for the past 20 years?" and "what salary does one need to afford the average home in major U.S. metros where the housing are the most expensive? Below is the <strong>map of the median home prices in major U.S. metros area from 2014-2018</strong>. Color and size of the metro differ based on the price. Hover over the circle for more details.</p>

<p class="descriptions" id="text2"><strong>Median house price from 1996 to 2019 for 36 major U.S. metro areas.</strong> One can see that housing price in some metro area like Pittsburg remain fairly constant with little to no inflation while others like Detroit depreciates a lot after financial crysis. Of course ones like San Francisco and San Jose have been going up to the extreme after the 2008 financial crisis.</p>

<p class="descriptions" id="text3"><strong>Which metro areas takes the crown when it comes to the salary needed to afford the average home? </strong>This is based on a 30 year mortage with a 10% down payment.</p>

<div class="slidecontainer">
    <input type="range" min="0" max="5" value="0" class="slider" id="myRange">
    <p id="yeartext1">Year: <span id="yeartext"></span></p>
</div>





<center><svg width="1280" height="768" id="svg1"></svg></center>
<svg width="1330" height="768" id="svg2"></svg>
<center><svg width="1280" height="728" id="svg3"></svg></center>



<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src='https://d3js.org/d3.v4.min.js'></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
<script>
    const width = 1280;
    const height = 768;

    var svg = d3.select("#svg1");
    var svg2 = d3.select("#svg2");
    var svg3 = d3.select("#svg3");


    const date = ["2014", "2015", "2016", "2017", "2018", "2019"];
    const raw_dates = ["1996-04", "1996-05", "1996-06", "1996-07", "1996-08", "1996-09", "1996-10", "1996-11", "1996-12", "1997-01", "1997-02", "1997-03", "1997-04", "1997-05", "1997-06", "1997-07", "1997-08", "1997-09", "1997-10", "1997-11", "1997-12", "1998-01", "1998-02", "1998-03", "1998-04", "1998-05", "1998-06", "1998-07", "1998-08", "1998-09", "1998-10", "1998-11", "1998-12", "1999-01", "1999-02", "1999-03", "1999-04", "1999-05", "1999-06", "1999-07", "1999-08", "1999-09", "1999-10", "1999-11", "1999-12", "2000-01", "2000-02", "2000-03", "2000-04", "2000-05", "2000-06", "2000-07", "2000-08", "2000-09", "2000-10", "2000-11", "2000-12", "2001-01", "2001-02", "2001-03", "2001-04", "2001-05", "2001-06", "2001-07", "2001-08", "2001-09", "2001-10", "2001-11", "2001-12", "2002-01", "2002-02", "2002-03", "2002-04", "2002-05", "2002-06", "2002-07", "2002-08", "2002-09", "2002-10", "2002-11", "2002-12", "2003-01", "2003-02", "2003-03", "2003-04", "2003-05", "2003-06", "2003-07", "2003-08", "2003-09", "2003-10", "2003-11", "2003-12", "2004-01", "2004-02", "2004-03", "2004-04", "2004-05", "2004-06", "2004-07", "2004-08", "2004-09", "2004-10", "2004-11", "2004-12", "2005-01", "2005-02", "2005-03", "2005-04", "2005-05", "2005-06", "2005-07", "2005-08", "2005-09", "2005-10", "2005-11", "2005-12", "2006-01", "2006-02", "2006-03", "2006-04", "2006-05", "2006-06", "2006-07", "2006-08", "2006-09", "2006-10", "2006-11", "2006-12", "2007-01", "2007-02", "2007-03", "2007-04", "2007-05", "2007-06", "2007-07", "2007-08", "2007-09", "2007-10", "2007-11", "2007-12", "2008-01", "2008-02", "2008-03", "2008-04", "2008-05", "2008-06", "2008-07", "2008-08", "2008-09", "2008-10", "2008-11", "2008-12", "2009-01", "2009-02", "2009-03", "2009-04", "2009-05", "2009-06", "2009-07", "2009-08", "2009-09", "2009-10", "2009-11", "2009-12", "2010-01", "2010-02", "2010-03", "2010-04", "2010-05", "2010-06", "2010-07", "2010-08", "2010-09", "2010-10", "2010-11", "2010-12", "2011-01", "2011-02", "2011-03", "2011-04", "2011-05", "2011-06", "2011-07", "2011-08", "2011-09", "2011-10", "2011-11", "2011-12", "2012-01", "2012-02", "2012-03", "2012-04", "2012-05", "2012-06", "2012-07", "2012-08", "2012-09", "2012-10", "2012-11", "2012-12", "2013-01", "2013-02", "2013-03", "2013-04", "2013-05", "2013-06", "2013-07", "2013-08", "2013-09", "2013-10", "2013-11", "2013-12", "2014-01", "2014-02", "2014-03", "2014-04", "2014-05", "2014-06", "2014-07", "2014-08", "2014-09", "2014-10", "2014-11", "2014-12", "2015-01", "2015-02", "2015-03", "2015-04", "2015-05", "2015-06", "2015-07", "2015-08", "2015-09", "2015-10", "2015-11", "2015-12", "2016-01", "2016-02", "2016-03", "2016-04", "2016-05", "2016-06", "2016-07", "2016-08", "2016-09", "2016-10", "2016-11", "2016-12", "2017-01", "2017-02", "2017-03", "2017-04", "2017-05", "2017-06", "2017-07", "2017-08", "2017-09", "2017-10", "2017-11", "2017-12", "2018-01", "2018-02", "2018-03", "2018-04", "2018-05", "2018-06", "2018-07", "2018-08", "2018-09", "2018-10", "2018-11", "2018-12", "2019-01", "2019-02", "2019-03", "2019-04", "2019-05"];
    const dates = raw_dates.map(d3.timeParse("%Y-%m"));
    const margin = ({
        top: 20,
        right: 110,
        bottom: 30,
        left: 80
    });


    //scale from date to pixel
    x = d3.scaleTime()
        .domain(d3.extent(dates))
        .range([margin.left, width - margin.right]);
    //scale from price to pixel
    y = d3.scaleLinear()
        .domain([58400, 1338325]).nice()
        .range([height - margin.bottom, margin.top]);

    const colorScale = d3.scaleSequential()
        .domain([0, 35])
        .interpolator(d3.interpolateWarm);

    function xAxis(g) {
        g.attr("transform", `translate(0,${height - margin.bottom})`)
            .call(d3.axisBottom(x).ticks(width / 80).tickSizeOuter(0));
    }

    function yAxis(g) {
        g.attr("transform", `translate(${margin.left},0)`)
            .call(d3.axisLeft(y))
            .call(g => g.select(".domain").remove())
            .call(g => g.select(".tick:last-of-type text").clone()
                .attr("x", 3)
                .attr("text-anchor", "start")
                .attr("font-weight", "bold")
                .text("Median House Price"))
    }

    var line = d3.line()
        .defined(d => d.price != null)
        .x(function(d, i) {
            return x(d.year);
        })
        .y(function(d) {
            return y(d.price);
        });

    svg2.append("g")
        .call(xAxis);

    svg2.append("g")
        .call(yAxis);



    var projection = d3.geoAlbersUsa().scale(1280).translate([480, 300]);

    var path = d3.geoPath();

    var div = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);


    var color = d3.scaleLinear()
        .domain([1338325, 350000, 104300])
        .range(['#d73027', '#fee08b', '#1a9850'])
        .interpolate(d3.interpolateHcl);

    var radius = d3.scaleLinear()
        .domain([104300, 1338325])
        .range([6, 15]);

    var first_time = true;


    d3.json("https://d3js.org/us-10m.v1.json", function(error, us) {
        if (error) throw error;

        svg.append("g")
            .attr("class", "states")
            .selectAll("path")
            .data(topojson.feature(us, us.objects.states).features)
            .enter().append("path")
            .attr("d", path)
            .attr("fill", "black");

        svg.append("path")
            .attr("class", "state-borders")
            .attr("d", path(topojson.mesh(us, us.objects.states, function(a, b) {
                return a !== b;
            })));

        d3.csv("data.csv", function(error, data) {
            if (error) throw error;

            //add function to update image
            var slider = document.getElementById("myRange"); //value on the slider
            var output = document.getElementById("yeartext");
            output.innerHTML = date[0]; //default value of slider
            //output.innerHTML = slider.value; // Display the default slider value

            //Build dataset from data.csv
            var dataset = [];
            for (var i = 0; i < data.length; i++) {
                dataset[i] = {
                    RegionName: data[i].RegionName,
                    prices: []
                };

                for (var j = 0; j < dates.length; j++) {
                    dataset[i].prices.push({
                        year: dates[j],
                        price: data[i][raw_dates[j]] == "" ? null : +data[i][raw_dates[j]]
                    });
                }
            }

            //plot lines
            var path = svg2
                .append("g")
                .attr("fill", "none")
                .attr("stroke-width", 1.5)
                .attr("stroke-linejoin", "round")
                .attr("stroke-linecap", "round")
                .selectAll("path")
                .data(dataset)
                .enter().append("path")
                .style("mix-blend-mode", "multiply")
                .attr("d", d => line(d.prices))
                .attr("stroke", (d, i) => colorScale(i));


            svg2.call(hover, path);

            //add legend
            var legend = svg2.selectAll(".lengend")
                .data(dataset)
                .enter()
                .append("g")
                .attr("class", "legend");

            var legend_cir = legend.append("circle")
                .attr("cx", width - 95)
                .attr("cy", (d, i) => margin.top + i * 12)
                .attr("r", 6)
                .style("fill", (d, i) => colorScale(i));

            var legend_txt = legend.append("text")
                .attr("x", width - 85)
                .attr("y", (d, i) => 25 + i * 12)
                .text(d => d.RegionName)


            //make annotation
            const annotations = [{
                note: {
                    label: "Housing price drops significantly with subprime mortage crisis",
                    title: "The Financial Crisis"
                },
                x: x(new Date("2008-03")),
                y: y(739700),
                dy: -100,
                dx: 100
            }]

            // Add annotation to the chart
            const makeAnnotations = d3.annotation()
                .annotations(annotations);


            function hover(svg2, path) {
                svg2
                    .style("position", "relative");

                if ("ontouchstart" in document) svg2
                    .style("-webkit-tap-highlight-color", "transparent")
                    .on("touchmove", moved)
                    .on("touchstart", entered)
                    .on("touchend", left)
                else svg2
                    .on("mousemove", moved)
                    .on("mouseenter", entered)
                    .on("mouseleave", left);

                const dot = svg2.append("g")
                    .attr("display", "none");

                dot.append("circle")
                    .attr("r", 2);

                dot.append("text")
                    .style("font", "10px sans-serif")
                    .attr("text-anchor", "middle")
                    .attr("y", -8);

                function moved() {
                    d3.event.preventDefault();
                    //get price
                    const p = y.invert(d3.event.layerY);
                    //get date
                    var d = x.invert(d3.event.layerX);
                    const i1 = d3.bisectLeft(dates, d, 1);
                    const i0 = i1 - 1;
                    const i = d - dates[i0] > dates[i1] - d ? i1 : i0;
                    const s = dataset.reduce((a, b) => Math.abs(a.prices[i].price - p) < Math.abs(b.prices[i].price - p) ? a : b);
                    path.attr("stroke", (d, i) => d.RegionName === s.RegionName ? colorScale(i) : "#ddd")
                        .filter(d => d.RegionName === s.RegionName).raise();
                    legend_cir.style("opacity", d => d.RegionName == s.RegionName ? 1.0 : 0.2)
                    legend_txt.style("opacity", d => d.RegionName == s.RegionName ? 1.0 : 0.2)
                    dot.attr("transform", `translate(${x(dates[i])},${y(s.prices[i].price)})`);
                    dot.select("text").text(s.RegionName + ", $" + s.prices[i].price);
                }

                function entered() {
                    //path.style("mix-blend-mode", null).attr("stroke", "#ddd");
                    dot.attr("display", "block");
                }

                function left() {
                    path.style("mix-blend-mode", "multiply").attr("stroke", (d, i) => colorScale(i));
                    dot.attr("display", "none");
                    legend_cir.style("opacity", 1)
                    legend_txt.style("opacity", 1)
                }
            }

            //Page 1

            svg.
            selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("cx", function(d) {
                    return projection([parseFloat(d.lng), parseFloat(d.lat)])[0];
                })
                .attr("cy", function(d) {
                    return projection([parseFloat(d.lng), parseFloat(d.lat)])[1];
                })
                .attr("r", function(d) {
                    return 1.5 * radius(d[date[slider.value]]);
                })
                .style("fill", function(d) {
                    return color(d[date[slider.value]]);
                })
                .style("opacity", 1)
                .on("mouseover", function(d) {
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    div.html(d["RegionName"] + "<br/>" + "$" + d[date[slider.value]])
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                // fade out tooltip on mouse out               
                .on("mouseout", function(d) {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                });


            // Update the current slider value when input change

            slider.oninput = function() {
                var myValue = this.value;
                //console.log(date[myValue]);
                output.innerHTML = date[myValue];
                updateChart(date[myValue]);
            }

            function updateChart(value) {
                svg.
                selectAll("circle")
                    .data(data)
                    .attr("r", function(d) {
                        return 1.5 * radius(d[value]);
                    })
                    .style("fill", function(d) {
                        return color(d[value]);
                    });
            }


            //Page 3
            d3.csv("salary_for_home.csv", function(error, data) {
                var x3 = d3.scaleLinear() //xscale
                    .domain([0, 320])
                    .range([0, 800]);


                var y3 = d3.scaleBand()
                    .domain(data.map(d => d.RegionName))
                    .range([20, 600])
                    .padding(0.15);

                svg3
                    .selectAll("rect")
                    .data(data)
                    .enter().append("rect")
                    .attr("class", "bar")
                    .style("fill", d => colorScale(d.ColorCode))
                    .attr("height", y3.bandwidth())
                    .attr("width", d => x3(+d.Salary / 1000))
                    .attr("x", margin.left)
                    .attr("y", d => y3(d.RegionName))

                    .style("stroke", "gray");

                svg3.
                selectAll("text")
                    .data(data)
                    .enter()
                    .append("text")
                    .attr("class", "label")
                    .attr("x", d => margin.left + 35 + x3(+d.Salary / 1000))
                    .text(d => "$" + d.Salary)
                    .attr("y", d => margin.bottom + y3(d.RegionName))
                    .style("fill", "black")
                    .style("font", "12px")
                    .style("text-anchor", "middle");


                var x_axis = d3.axisBottom()
                    .scale(x3);

                svg3.append("g")
                    .attr("transform", "translate(" + margin.left + ", 600)")
                    .call(x_axis);

                var y_axis = d3.axisLeft()
                    .scale(y3);

                svg3.append("g")
                    .attr("transform", "translate(" + margin.left + ", 0)")
                    .call(y_axis);
            });


            //button press, switch scenes
            $(document).ready(function() {
                $("#1").click(function() {
                    $("#svg1, #myRange, #yeartext1, #text1").css("display", "block");
                    $("#svg2, #svg3, #text2, #text3").css("display", "none");
                });
            });

            $(document).ready(function() {
                $("#2").click(function() {
                    $("#svg1, #svg3, #myRange, #yeartext1, #text1, #text3").css("display", "none");
                    $("#svg2, #text2").css("display", "block");
                    if (first_time === true) {
                        first_time = false;
                        svg2
                            .append("g")
                            .call(makeAnnotations);
                    }

                });
            });

            $(document).ready(function() {
                $("#3").click(function() {
                    $("#svg1, #svg2, #svg4, #myRange, #yeartext1, #text1, #text2").css("display", "none");
                    $("#svg3, #text3").css("display", "block");
                });
            });



        });
    });

</script>
